<!DOCTYPE html>
<html lang="en">
<head>
      <meta charset="UTF-8">
    <title>DNeSH - Diagnostic Network for Secondary Hypertension</title>
    <link rel="icon" type="image/png" href="https://i.postimg.cc/VsXrz9Pk/global-network-1.png">
    <meta property="og:title" content="DNeSH - Diagnostic Network for Secondary Hypertension">
    <meta property="og:description" content="Mapping all the Causes and Learning from Experience = Modern Personalized Medicine">
    <meta property="og:image" content="https://i.postimg.cc/XYYpKTGr/global-network-2.png">
    <meta property="og:url" content="https://dnesh.me">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <script src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
      
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7fa;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            background-color: #fff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        header {
            background-color: #FFD700;
            color: #fff;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        main {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .form-container,
        .results-container {
            margin: 10px 0;
        }

        .form-container {
            background: #f0f4f8;
            padding: 20px;
            border-radius: 8px;
        }

        .form-container h2 {
            margin-bottom: 15px;
        }

        /* Updated CSS selector to target labels inside .form-container */
        .form-container label {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 16px;
        }

        select {
            width: 200px;
            padding: 5px;
            border-radius: 4px;
        }

        .results-container h2 {
            margin-bottom: 15px;
        }

        #patientTable {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        #patientTable th,
        #patientTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }

        #patientTable tr.secondary-hypertension {
            background-color: #ffdddd;
        }

        #patientTable tr.primary-hypertension {
            background-color: #ddffdd;
        }

        .legend {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .legend-secondary {
            background-color: #ffdddd;
            padding: 5px;
            border-radius: 5px;
        }

        .legend-primary {
            background-color: #ddffdd;
            padding: 5px;
            border-radius: 5px;
        }

        .statistics {
            padding: 10px;
            background: #e9f5ff;
            border-radius: 8px;
            text-align: center;
        }

        #secondaryHypertensionPercentage {
            font-size: 24px;
            color: #E74C3C;
            margin: 0;
        }

        .results-overview {
            margin-bottom: 20px;
            text-align: center;
        }

        #ageHistogram {
            width: 100%;
            max-height: 400px;
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f8f9fa;
        }

        #maleBarChart, #countryBarChart {
            height: 300px;
            max-height: 300px;
        }
      
        .table-container {
            overflow-x: auto;
            max-width: 100%;
        }

        /* Styles for the download button */
        .download-btn {
            background-color: #4A90E2;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .download-btn:hover {
            background-color: #357ABD;
        }

        /* Ensure IDs are unique */
        .toggleFullscreen {
            /* Add any styles if necessary */
        }
          
        .group-toggle-container {
            margin-bottom: 10px;
        }
        .group-toggle {
            cursor: pointer;
            padding: 5px 10px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 3px;
        }
        .group-toggle.off {
            background-color: #ccc;
            color: #666;
        }    
        .deleteButton { cursor: pointer; padding: 5px 10px; margin: 5px; background-color: #f44336; color: white; border: none; border-radius: 3px; }
        .deleteButton:hover { background-color: #cc0000; }
        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 8px; border-bottom: 1px solid #ddd; }
        th { background-color: #f2f2f2; }
        .button { cursor: pointer; padding: 5px 10px; margin: 5px; background-color: #4CAF50; color: white; border: none; border-radius: 3px; }
        .button:hover { background-color: #45a049; }
        #resetButton { background-color: #f44336; }
        #resetButton:hover { background-color: #cc0000; }
        .copyButton { padding: 4px 8px; }
        #degreeChart, #clusteringChart {
            display: none;
            height: 400px;
        }
        .vis-tooltip {
            z-index: 10000 !important;
        }
        #mynetwork {
            width: 100%;
            height: 600px;
            border: 1px solid lightgray;
            background-color: white;
            position: relative;
            page-break-inside: avoid; /* Ensure the network graph doesn't break */
        }

        #watermark {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: gray;
            opacity: 0.5; /* Adjust transparency */
            font-size: 12px;
            z-index: 1000; /* Ensure it stays on top */
        }
        #watermark a {
            color: gray; /* Match the text color of the watermark */
            text-decoration: none; /* No underline for the link */
        }

        @property --_l {
            syntax: "<length>";
            initial-value: 0px;
            inherits: true;
        }
        @property --_r {
            syntax: "<length>";
            initial-value: 0px;
            inherits: true;
        }

        .container2 {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Horizontal spacing between boxes */
            justify-content: center;
            margin-bottom: 40px; /* Vertical spacing between rows on larger screens */
        }

        .drug-box {
            --d: 18px;  /* the depth */
            --a: 20deg; /* the angle */
            --x: 10px;  /* lateral width */

            width: 300px; /* Width for the frontal face */
            aspect-ratio: 2.2;
            object-fit: cover;
            padding-block: var(--d);
            transform: perspective(600px) rotateY(calc(var(--_i, 1) * var(--a)));
            outline: var(--d) solid #0008;
            outline-offset: calc(-1 * var(--d));
            --_d: calc(100% - var(--d));
            --_l: 0px;
            --_r: 0px;
            clip-path: polygon(
                var(--_l) calc(var(--_d) - var(--x)),
                var(--_l) calc(var(--d) + var(--x)), 
                var(--d) var(--d), var(--_d) var(--d),
                calc(var(--_d) + var(--_r)) calc(var(--d) + var(--x)),
                calc(var(--_d) + var(--_r)) calc(var(--_d) - var(--x)),  
                var(--_d) var(--_d), var(--d) var(--_d)
            );
            transition: transform .3s, --_r .15s, --_l .15s .15s;
            transition-timing-function: linear;
            cursor: pointer;
            display: block;
            max-width: 100%;
        }

        .drug-box:hover,
        .drug-box.alt {
            --_l: var(--d);
            --_r: var(--d);
            --_i: -1;
            transition-delay: 0s, .15s, 0s;
        }

        /* Information section styles */
        .info-sections {
            display: block; /* Ensure this container is visible */
            margin-top: 20px;
        }

        .info-section {
            display: none;
            padding: 20px;
            margin-bottom: 20px;
        }

        /* Responsive vertical spacing for larger screens */
        @media (min-width: 1024px) {
            .container2 {
                row-gap: 40px; /* Increased vertical gap for large screens */
            }
        }

    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>DNeSH</h1>
            <p>Diagnostic Network for Secondary Hypertension</p>
            <p>v0.26</p>
          <p><a href="https://forms.gle/11vqK1EhyQBbrBdt5" target="_blank">Sign Up</a> to Submit Clinical Cases</p>
          <p><a href="mailto:andrefrsilva@edu.ulisboa.pt">Contact Us</a></p>
        </header>
        <main>

              <div class="container2">
  <img class="drug-box" src="https://raw.githubusercontent.com/andrefrsilva/dnesh/refs/heads/main/DNESH%20MASTERPLAN%202.png" alt="DNeSH Masterplan" data-id="1">
  <img class="drug-box" src="https://raw.githubusercontent.com/andrefrsilva/dnesh/refs/heads/main/HYPERTENSION%202%20...png" alt="Hypertension" data-id="2">
</div>

<div id="mynetwork" style="display: none;"></div>
  
<div class="info-sections">
  <div id="section-1" class="info-section">
    <h1>DNeSH Masterplan</h1>
    
    <!-- Changed id to class -->
    <br /><br /><button class="toggleFullscreen">Fullscreen</button> 

    <br /><br />
    <input type="checkbox" id="physicsCheck" checked> Physics<br><br>

    <!-- Labels without conflicting styles -->
    <label>
      <input type="checkbox" id="seeAllDescendantsCheckbox" name="seeAllDescendants">
      See all affected Nodes when selecting One
    </label>
    <br><br>

    <label>
      <input type="checkbox" id="curvedEdgesCheckbox"> Curved Edges
    </label>
    
    <br>
    <p>Groups:</p>
    <div id="groupToggles"></div>

    <!-- Additional elements (hidden) -->
    <!-- ... -->

  </div>
  <div id="section-2" class="info-section">
    <h1>Foundational Hypertension Network</h1>
    
    <!-- Changed id to class -->
    <br /><br /><button class="toggleFullscreen">Fullscreen</button> 

    <br /><br />
    <input type="checkbox" id="physicsCheck" checked> Physics<br><br>

    <!-- Labels without conflicting styles -->
    <label>
      <input type="checkbox" id="seeAllDescendantsCheckbox" name="seeAllDescendants">
      See all affected Nodes when selecting One
    </label>
    <br><br>

    <label>
      <input type="checkbox" id="curvedEdgesCheckbox"> Curved Edges
    </label>
    
    <br>
    <p>Groups:</p>
    <div id="groupToggles"></div>

    <!-- Additional elements (hidden) -->
    <!-- ... -->

  </div>
</div>

<!-- Hidden buttons -->
<button id="loadDataButton1" style="display:none;">Load Data 1</button>
<button id="loadDataButton2" style="display:none;">Load Data 2</button>
<button id="loadDataButton3" style="display:none;">Load Data 3</button>
<button id="loadDataButton4" style="display:none;">Load Data 4</button>
<button id="loadDataButton5" style="display:none;">Load Data 5</button>


              
            <div class="form-container">
                <h2>Patient Data</h2>
                <form id="patientForm">
                    <label>
                        <span>Country</span>
                        <select id="countryFilter">
                            <option value="All">All</option>
                        </select>
                    </label>
                    <label>
                        <span>Primary Cause</span>
                        <select id="primaryCauseFilter">
                            <option value="All">All</option>
                        </select>
                    </label>

                    <!-- Binary filters -->
                    <!-- Include all the filters specified -->
                    <label><span>Male</span>
                        <select name="Male" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Continue with all other filters -->
                    <!-- <40 years old onset -->
                    <label><span>&lt;40 years old onset</span>
                        <select name="<40 years old onset" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- >65 years old onset -->
                    <label><span>&gt;65 years old onset</span>
                        <select name=">65 years old onset" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Abrupt Onset -->
                    <label><span>Abrupt Onset</span>
                        <select name="Abrupt Onset" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Treatment Resistant -->
                    <label><span>Treatment Resistant</span>
                        <select name="Treatment Resistant" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Therapeutic Adherence -->
                    <label><span>Therapeutic Adherence</span>
                        <select name="Therapeutic Adherence" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Left-Right Arm Diff >10 -->
                    <label><span>Left-Right Arm Diff &gt;10</span>
                        <select name="Left-Right Arm Diff >10" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Arm-Leg Diff -->
                    <label><span>Arm-Leg Diff</span>
                        <select name="Arm-Leg Diff" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Dyslipidemia -->
                    <label><span>Dyslipidemia</span>
                        <select name="Dyslipidemia" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Diabetes -->
                    <label><span>Diabetes</span>
                        <select name="Diabetes" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Stroke -->
                    <label><span>Stroke</span>
                        <select name="Stroke" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Myocardial Infarction -->
                    <label><span>Myocardial Infarction</span>
                        <select name="Myocardial Infarction" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Smokes or Smoked -->
                    <label><span>Smokes or Smoked</span>
                        <select name="Smokes or Smoked" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Hypokalemia -->
                    <label><span>Hypokalemia</span>
                        <select name="Hypokalemia" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Sleep Apnea -->
                    <label><span>Sleep Apnea</span>
                        <select name="Sleep Apnea" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Family History of PHT -->
                    <label><span>Family History of PHT</span>
                        <select name="Family History of PHT" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Family History of SHT -->
                    <label><span>Family History of SHT</span>
                        <select name="Family History of SHT" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Obesity -->
                    <label><span>Obesity</span>
                        <select name="Obesity" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- High Cortisol -->
                    <label><span>High Cortisol</span>
                        <select name="High Cortisol" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Pulmonary Edema -->
                    <label><span>Pulmonary Edema</span>
                        <select name="Pulmonary Edema" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Abdominal bruit -->
                    <label><span>Abdominal bruit</span>
                        <select name="Abdominal bruit" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- High Serum Creatinine -->
                    <label><span>High Serum Creatinine</span>
                        <select name="High Serum Creatinine" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Hematuria -->
                    <label><span>Hematuria</span>
                        <select name="Hematuria" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Proteinuria -->
                    <label><span>Proteinuria</span>
                        <select name="Proteinuria" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Family History of Polycystic Kidney Disease -->
                    <label><span>Family History of Polycystic Kidney Disease</span>
                        <select name="Family History of Polycystic Kidney Disease" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Cramps -->
                    <label><span>Cramps</span>
                        <select name="Cramps" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Headaches -->
                    <label><span>Headaches</span>
                        <select name="Headaches" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Sweating -->
                    <label><span>Sweating</span>
                        <select name="Sweating" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Palpitations -->
                    <label><span>Palpitations</span>
                        <select name="Palpitations" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Tinnitus -->
                    <label><span>Tinnitus</span>
                        <select name="Tinnitus" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Atrial Fibrillation -->
                    <label><span>Atrial Fibrillation</span>
                        <select name="Atrial Fibrillation" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- High Aldosterone/Renin Ratio -->
                    <label><span>High Aldosterone/Renin Ratio</span>
                        <select name="High Aldosterone/Renin Ratio" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- NSAIDs -->
                    <label><span>NSAIDs</span>
                        <select name="NSAIDs" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Oral Contraceptives -->
                    <label><span>Oral Contraceptives</span>
                        <select name="Oral Contraceptives" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Steroids -->
                    <label><span>Steroids</span>
                        <select name="Steroids" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Sympathomimetic Agents -->
                    <label><span>Sympathomimetic Agents</span>
                        <select name="Sympathomimetic Agents" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Caffeine -->
                    <label><span>Caffeine</span>
                        <select name="Caffeine" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                    <!-- Nicotine -->
                    <label><span>Nicotine</span>
                        <select name="Nicotine" class="binary-select">
                            <option value="All">All</option>
                            <option value="1">Yes</option>
                            <option value="0">No</option>
                        </select>
                    </label>
                </form>
            </div>

            <!-- Section for participant count and gender distribution -->
            <div class="results-overview">
                <h2>Filtered Participants <span id="participantCount"></span></h2>
                <canvas id="ageHistogram" style="width: 100%; height: 400px;"></canvas>
            </div>

            <div class="results-container">
                <!-- Replace the hypertension diagnosed section with the new table -->
                <center><h2>Distribution of Primary Causes</h2></center>
                <table id="primaryCauseTable" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Diagnostic</th>
                            <th>%</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <br>
                <canvas id="maleBarChart" style="width: 100%; height: 300px;"></canvas>
                <canvas id="countryBarChart" style="width: 100%; height: 300px;"></canvas>
                <br>
                <div class="statistics">
                    <h3>Percentage with Secondary Hypertension:</h3>
                    <p id="secondaryHypertensionPercentage">0%</p>
                </div>
                <br>
                <!-- Remove the combined bar plot as per point 9 -->
                <!-- Odds Ratio Table -->
                <center><h2>Factors Associated with Secondary Hypertension</h2></center>
                <table id="oddsRatioTable" style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead>
                        <tr>
                            <th>Variable</th>
                            <th>Odds Ratio</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
              
              <br><br><br>
                              <!-- Add download button above the table -->
<button id="downloadButton" class="download-btn">
    <i class="fas fa-download"></i> Download Original Data
</button>
              
                <br><br><br>
                <div class="legend">
                    <span class="legend-secondary">Secondary Hypertension</span>
                    <span class="legend-primary">Primary Hypertension</span>
                </div>

<!-- Wrap the table inside a scrollable div -->
<div class="table-container">
    <table id="patientTable">
        <thead>
            <tr>
                <!-- Include Age and all filter columns -->
                <th>Age</th>
                <th>Country</th>
                <th>Primary Cause</th>
                <th>Male</th>
                <th>&lt;40 years old onset</th>
                <th>&gt;65 years old onset</th>
                <th>Abrupt Onset</th>
                <th>Treatment Resistant</th>
                <th>Therapeutic Adherence</th>
                <th>Left-Right Arm Diff &gt;10</th>
                <th>Arm-Leg Diff</th>
                <th>Dyslipidemia</th>
                <th>Diabetes</th>
                <th>Stroke</th>
                <th>Myocardial Infarction</th>
                <th>Smokes or Smoked</th>
                <th>Hypokalemia</th>
                <th>Sleep Apnea</th>
                <th>Family History of PHT</th>
                <th>Family History of SHT</th>
                <th>Obesity</th>
                <th>High Cortisol</th>
                <th>Pulmonary Edema</th>
                <th>Abdominal bruit</th>
                <th>High Serum Creatinine</th>
                <th>Hematuria</th>
                <th>Proteinuria</th>
                <th>Family History of Polycystic Kidney Disease</th>
                <th>Cramps</th>
                <th>Headaches</th>
                <th>Sweating</th>
                <th>Palpitations</th>
                <th>Tinnitus</th>
                <th>Atrial Fibrillation</th>
                <th>High Aldosterone/Renin Ratio</th>
                <th>NSAIDs</th>
                <th>Oral Contraceptives</th>
                <th>Steroids</th>
                <th>Sympathomimetic Agents</th>
                <th>Caffeine</th>
                <th>Nicotine</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


            </div>
        </main>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
  // Global variables
  var nodes = new vis.DataSet([]);
  var edges = new vis.DataSet([]);
  var network = null;
  var options = null;

  const boxes = document.querySelectorAll('.drug-box');
  const sections = document.querySelectorAll('.info-section');  
  const networkContainer = document.getElementById('mynetwork');

  // Global variables for data analysis
  const excelUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRpHz_MgeygnnVAYUTlnq2wQJp8Owg1vurrWw1kmz3Up4kJK0KXWy4LKmml5jBj2XvwlKAB0ItSFFfr/pub?output=xlsx';
  let patientData = [];
  let ageHistogramChart;
  let maleBarChart, countryBarChart;
  let variablesList = [
    'Male',
    '<40 years old onset',
    '>65 years old onset',
    'Abrupt Onset',
    'Treatment Resistant',
    'Therapeutic Adherence',
    'Left-Right Arm Diff >10',
    'Arm-Leg Diff',
    'Dyslipidemia',
    'Diabetes',
    'Stroke',
    'Myocardial Infarction',
    'Smokes or Smoked',
    'Hypokalemia',
    'Sleep Apnea',
    'Family History of PHT',
    'Family History of SHT',
    'Obesity',
    'High Cortisol',
    'Pulmonary Edema',
    'Abdominal bruit',
    'High Serum Creatinine',
    'Hematuria',
    'Proteinuria',
    'Family History of Polycystic Kidney Disease',
    'Cramps',
    'Headaches',
    'Sweating',
    'Palpitations',
    'Tinnitus',
    'Atrial Fibrillation',
    'High Aldosterone/Renin Ratio',
    'NSAIDs',
    'Oral Contraceptives',
    'Steroids',
    'Sympathomimetic Agents',
    'Caffeine',
    'Nicotine'
  ];

  let seeAllDescendants = true;
  let groupTogglesContainer; // Declare globally

  // Define the Excel URLs for networks
  const excelURLs = [
    null, // Index 0 placeholder
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vRvjYpSElYA_V-uhjJ6Xy0Oh7YWtrxPQfnWhRBd2xVvT1l1CKjiKxD-o23XHovZEu9BB7iPOiKrtAnj/pub?output=xlsx',
    'https://docs.google.com/spreadsheets/d/e/2PACX-1vRupeTiNilcBPCjsmw3djxoTbo0rsOLtYol6OP5vNfa7rzCHBy8Iuta-He54gGAugjsABhVMb_6SUeg/pub?output=xlsx'
  ];

  document.addEventListener("DOMContentLoaded", function() {
    // Initialize the network
    var container = document.getElementById("mynetwork");
    var data = {
      nodes: nodes,
      edges: edges,
    };
    options = {
      layout: { randomSeed: 2 },
      physics: {
        enabled: true,
        solver: "barnesHut",
        barnesHut: {
          gravitationalConstant: -8000,
          springLength: 10,
          centralGravity: 0.01,
        },
        maxVelocity: 135,
        timestep: 0.35,
        stabilization: {
          enabled: true,
          iterations: 600,
          updateInterval: 10,
          onlyDynamicEdges: false,
          fit: true
        }
      },
      nodes: {
        shape: "dot",
        scaling: {
          customScalingFunction: function (min, max, total, value) {
            return value / total;
          },
          min: 5,
          max: 50,
        },
      },
      edges: {
        color: {
          inherit: false,
        },
        scaling: {
          min: 0.5,
          max: 3,
        },
        smooth: {
          enabled: false,
          type: 'dynamic',
        },
      },
    };
    network = new vis.Network(container, data, options);

    boxes.forEach(box => {
      box.addEventListener('click', () => {
        const id = box.getAttribute('data-id');
        const section = document.getElementById(`section-${id}`);

        // Close all other sections
        sections.forEach(sec => {
          if (sec !== section) {
            sec.style.display = 'none';
          }
        });

        section.style.display = 'block';

        // Move the network container into the current section
        const h1 = section.querySelector('h1');
        if (h1) {
          h1.insertAdjacentElement('afterend', networkContainer);
        } else {
          section.insertAdjacentElement('afterbegin', networkContainer);
        }

        // Ensure the network container is visible
        networkContainer.style.display = 'block';

        // Smooth scroll to the section
        smoothScroll(section, 1300);

        // Set up event listeners for controls in this section
        const physicsCheck = section.querySelector('.physicsCheck');
        const seeAllDescendantsCheckbox = section.querySelector('.seeAllDescendantsCheckbox');
        const curvedEdgesCheckbox = section.querySelector('.curvedEdgesCheckbox');
        groupTogglesContainer = section.querySelector('.groupToggles');

        // Update options based on the current controls
        options.physics.enabled = physicsCheck.checked;
        options.edges.smooth.enabled = curvedEdgesCheckbox.checked;
        network.setOptions(options);

        physicsCheck.addEventListener('change', function() {
          options.physics.enabled = this.checked;
          network.setOptions(options);
          network.redraw();
        });

        seeAllDescendantsCheckbox.addEventListener('change', function() {
          seeAllDescendants = this.checked;
        });

        curvedEdgesCheckbox.addEventListener('change', function() {
          options.edges.smooth.enabled = this.checked;
          network.setOptions(options);
          network.redraw();
        });

        // Load the data for this section
        loadDataForSection(id);
      });
    });

    // Modify the network event handlers to use the global variable
    network.on('selectNode', function (properties) {
      let nodesToUpdate = [];
      let allNodes = nodes.get(); // Get all nodes

      allNodes.forEach(node => {
        if (properties.nodes.includes(node.id)) {
          nodesToUpdate.push({ id: node.id, hidden: false, color: node.originalColor });
        } else {
          nodesToUpdate.push({ id: node.id, hidden: true });
        }
      });

      const addChildNodes = (nodeId, nodesMap, recursive = true) => {
        let connectedEdges = edges.get({
          filter: function (edge) {
            return edge.from === nodeId;
          }
        });

        connectedEdges.forEach((edge) => {
          let childId = edge.to;
          let childNode = nodesMap.find(node => node.id === childId);
          if (childNode && childNode.hidden) {
            childNode.hidden = false;
            childNode.color = nodes.get(childId).originalColor;
            if (recursive) {
              addChildNodes(childId, nodesMap, seeAllDescendants);
            }
          }
        });
      };

      properties.nodes.forEach(nodeId => {
        addChildNodes(nodeId, nodesToUpdate, seeAllDescendants);
      });

      nodes.update(nodesToUpdate);
    });

    network.on('deselectNode', function (properties) {
      let nodesToUpdate = [];
      let allNodes = nodes.get(); // Get all nodes

      allNodes.forEach(node => {
        if (node.hidden) {
          nodesToUpdate.push({ id: node.id, hidden: false, color: node.originalColor });
        } else {
          nodesToUpdate.push({ id: node.id, color: node.originalColor });
        }
      });

      nodes.update(nodesToUpdate);
    });

    // Add the watermark
    var watermark = document.createElement('div');
    watermark.id = 'watermark';
    watermark.innerHTML = `<a href="https://www.linkedin.com/in/andrefrsilva/" target="_blank">DNeSH © ${new Date().getFullYear()}</a>`;
    networkContainer.appendChild(watermark);

    // Load patient data and initialize filters
    loadExcelData();

    // Add event listeners to filters
    document.querySelectorAll('.binary-select').forEach(select => {
      select.addEventListener('change', updateResults);
    });
    document.getElementById('countryFilter').addEventListener('change', updateResults);
    document.getElementById('primaryCauseFilter').addEventListener('change', updateResults);

    // Add event listener for the download button
    document.getElementById('downloadButton').addEventListener('click', function() {
      window.open(excelUrl, '_blank');
    });
  });

  // Smooth scroll function
  function smoothScroll(target, duration) {
    const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
    const startPosition = window.pageYOffset;
    const distance = targetPosition - startPosition;
    let startTime = null;

    function animation(currentTime) {
      if (startTime === null) startTime = currentTime;
      const timeElapsed = currentTime - startTime;
      const run = easeInOut(timeElapsed, startPosition, distance, duration);
      window.scrollTo(0, run);
      if (timeElapsed < duration) requestAnimationFrame(animation);
    }

    function easeInOut(t, b, c, d) {
      t /= d / 2;
      if (t < 1) return c / 2 * t * t + b;
      t--;
      return -c / 2 * (t * (t - 2) - 1) + b;
    }

    requestAnimationFrame(animation);
  }

  function loadDataForSection(id) {
    const url = excelURLs[id];
    if (url) {
      loadDataFromGivenURL(url);
    } else {
      console.error('No data URL defined for section', id);
    }
  }

  async function loadDataFromGivenURL(url) {
    try {
      const response = await fetch(url, { cache: 'no-store' });
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      const blob = await response.blob();
      processExcel(blob); // Process the Excel file
    } catch (error) {
      console.error("Error loading the Excel file:", error);
    }
  }

  function processExcel(blob) {
    nodes.clear(); // Clear existing nodes
    edges.clear(); // Clear existing edges
    groupFilters = {}; // Reset group filters

    var reader = new FileReader();

    reader.onload = function(e) {
      var data = e.target.result;
      var workbook = XLSX.read(data, {type: "binary"});

      // Read "nodes" sheet
      var nodesSheet = workbook.Sheets["nodes"];
      if (!nodesSheet) {
        console.error("No 'nodes' sheet found in the Excel file.");
        return;
      }
      var nodesData = XLSX.utils.sheet_to_json(nodesSheet, {header: 1});
      nodesData.shift(); // Remove header row

      nodesData.forEach(function(row) {
        if (row.every(cell => cell === undefined || cell === null || cell === '')) {
          return; // Skip this row
        }
        var nodeId = row[0] ? row[0].replace(/\s+/g, '') : '';
        var value = row[2] ? row[2] : '';
        var color = row[1] ? row[1] : 'black';
        var title = row[3] ? row[3] : '';
        var group = row[4] ? row[4] : null; // Assuming group info is in the 5th column

        if(group) {
          groupFilters[group] = true; // Mark group as visible by default
        }

        var nodeOptions = {
          id: nodeId,
          label: row[0],
          value: value,
          color: color, // This is the color from Sheets data
          title: title,
          group: group,
          hidden: group ? !groupFilters[group] : false,
          originalColor: color, // Store the original color
          font: { background: 'white', color: 'black' } // Set label background and text color
        };

        nodes.add(nodeOptions);
      });

      // Read "edges" sheet
      var edgesSheet = workbook.Sheets["edges"];
      if (!edgesSheet) {
        console.error("No 'edges' sheet found in the Excel file.");
        return;
      }
      var edgesData = XLSX.utils.sheet_to_json(edgesSheet, {header: 1});
      edgesData.shift(); // Remove header row

      edgesData.forEach(function(row) {
        if (row.every(cell => cell === undefined || cell === null || cell === '')) {
          return; // Skip empty rows
        }

        var color = "grey";
        var dashes = false;
        if (row[2] === "promotes") color = "green";
        else if (row[2] === "inhibits") color = "red";
        else if (row[2] === "link") {
          color = "black";
          dashes = true;
        }

        var title = row[4] ? row[4] : ''; // Comment from column E
        var value = row[3] ? parseFloat(row[3]) : undefined; // Value from column D

        // Define min and max values for thickness and length
        var minThickness = 0.5;
        var maxThickness = 10;
        var minLength = 40;
        var maxLength = 120;

        // Normalize value for thickness and length
        var thickness = value !== undefined ? Math.max(minThickness, minThickness + (value / 100) * (maxThickness - minThickness)) : minThickness;
        var length = value !== undefined ? Math.max(minLength, maxLength - (value / 100) * (maxLength - minLength)) : minLength;

        // Assuming row[0] and row[1] are the IDs for the source and target nodes
        var fromNode = row[0].replace(/\s+/g, '');
        var toNode = row[1].replace(/\s+/g, '');

        edges.add({
          from: fromNode,
          to: toNode,
          arrows: row[2] === "link" ? "" : "to",
          color: color,
          dashes: dashes,
          title: title, // Add the comment as title
          width: thickness, // Set the thickness directly
          length: length,   // Set the length directly
        });
      });

      // Update the network with new data
      network.setData({nodes: nodes, edges: edges});

      // Render group toggles in the current section
      renderGroupToggles(groupTogglesContainer);

      // Stabilize the network to adjust the layout
      network.stabilize();
    };

    reader.onerror = function(error) {
      console.error("Error reading the Excel file:", error);
    };

    reader.readAsBinaryString(blob);
  }

  // Group filters and functions
  var groupFilters = {};

  function renderGroupToggles(container) {
    container.innerHTML = ""; // Clear previous toggles

    Object.keys(groupFilters).forEach(function(group) {
      var button = document.createElement("button");
      button.innerText = group;
      button.classList.add("group-toggle", "button");
      button.onclick = function() {
        // Toggle group visibility
        groupFilters[group] = !groupFilters[group];
        button.classList.toggle("off", !groupFilters[group]);
        updateNetworkVisibility();
      };

      container.appendChild(button);
    });
  }

  function updateNetworkVisibility() {
    nodes.forEach(function(node) {
      var shouldBeHidden = node.group && !groupFilters[node.group];
      nodes.update({
        id: node.id,
        hidden: shouldBeHidden,
        color: node.originalColor // Use the original color stored for the node
      });
    });

    edges.forEach(function(edge) {
      var fromNode = nodes.get(edge.from);
      var toNode = nodes.get(edge.to);
      edges.update({
        id: edge.id,
        hidden: fromNode.hidden || toNode.hidden
      });
    });
  }

  // Fullscreen functions
  function enterFullscreen(element) {
    if (element.requestFullscreen) {
      element.requestFullscreen();
    } else if (element.mozRequestFullScreen) {
      element.mozRequestFullScreen();
    } else if (element.webkitRequestFullscreen) {
      element.webkitRequestFullscreen();
    } else if (element.msRequestFullscreen) {
      element.msRequestFullscreen();
    }
  }

  function exitFullscreen() {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    } else if (document.mozCancelFullScreen) {
      document.mozCancelFullScreen();
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    }
  }

  function isFullscreen() {
    return !!(
      document.fullscreenElement ||
      document.webkitFullscreenElement ||
      document.mozFullScreenElement ||
      document.msFullscreenElement
    );
  }

  // Event delegation for fullscreen buttons
  document.addEventListener("click", function(event) {
    if (event.target.classList.contains("toggleFullscreen")) {
      var container = document.getElementById("mynetwork");
      if (isFullscreen()) {
        exitFullscreen();
      } else {
        enterFullscreen(container);
      }
    }
  });

  // Data analysis and plotting functions

  async function loadExcelData() {
    const response = await fetch(excelUrl);
    const data = await response.arrayBuffer();
    const workbook = XLSX.read(data, { type: 'array' });
    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
    patientData = XLSX.utils.sheet_to_json(firstSheet);

    populateFilters();
    updateResults();
  }

  // Populate dropdown filters with unique values
  function populateFilters() {
    populateDropdown('Country', 'countryFilter');
    populateDropdown('Primary Cause', 'primaryCauseFilter');
  }

  // Populate a dropdown with unique values from a column, filtering out empty or space-only values
  function populateDropdown(column, dropdownId) {
    const values = [...new Set(patientData.map(item => item[column]?.toString().trim()))]
      .filter(value => value && value.trim() !== ''); // Remove empty or space-only values
    const dropdown = document.getElementById(dropdownId);
    values.forEach(value => {
      const option = document.createElement('option');
      option.value = value;
      option.textContent = value;
      dropdown.appendChild(option);
    });
  }

  // Helper function to parse and clean the value
  function getValue(patient, key) {
    let value = patient[key];
    if (typeof value === 'string') {
      value = value.trim().toLowerCase();
      if (value === 'yes') return 1;
      if (value === 'no') return 0;
    }
    return parseFloat(value) || 0; // Convert to a number, defaulting to 0 if not a valid number
  }

  // Update the participant count and male distribution
  function updateParticipantCount(filteredPatients) {
    const total = filteredPatients.length;
    const maleCount = filteredPatients.filter(p => getValue(p, 'Male') === 1).length;
    const femaleCount = total - maleCount;
    document.getElementById('participantCount').textContent = `(${total}: ${maleCount} males and ${femaleCount} females)`;
  }

  function createAgeHistogram(filteredPatients) {
    // Create bins for 10-year intervals
    const ageBins = Array.from({ length: 10 }, (_, i) => ({
      label: `${i * 10}-${i * 10 + 9}`,
      count: 0
    }));

    // Populate the age bins with data
    filteredPatients.forEach(p => {
      const age = getValue(p, 'Age');
      const binIndex = Math.floor(age / 10);
      if (binIndex >= 0 && binIndex < ageBins.length) {
        ageBins[binIndex].count++;
      }
    });

    // Prepare data for the chart
    const labels = ageBins.map(bin => bin.label);
    const data = ageBins.map(bin => bin.count);

    // If the chart already exists, destroy it before creating a new one
    if (ageHistogramChart) {
      ageHistogramChart.destroy();
    }

    const ctx = document.getElementById('ageHistogram').getContext('2d');
    ageHistogramChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Participant Ages',
          data: data,
          backgroundColor: '#4A90E2',
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'Age Distribution'
          }
        },
        scales: {
          x: { title: { display: true, text: 'Age' } },
          y: { title: { display: true, text: 'Number of Participants' } }
        }
      }
    });
  }

  // Function to create a bar chart for the number of participants by Male
  function createMaleBarChart(filteredPatients) {
    const maleCounts = filteredPatients.reduce((acc, patient) => {
      const maleValue = getValue(patient, 'Male');
      const key = maleValue === 1 ? 'Male' : 'Female';
      acc[key] = (acc[key] || 0) + 1;
      return acc;
    }, {});

    const labels = Object.keys(maleCounts);
    const data = Object.values(maleCounts);

    if (maleBarChart) {
      maleBarChart.destroy();
    }

    const ctx = document.getElementById('maleBarChart').getContext('2d');
    maleBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Number of Participants by Sex',
          data: data,
          backgroundColor: ['#4A90E2', '#FF00FF'],
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'Number of Participants by Sex'
          }
        },
        scales: {
          x: { title: { display: true, text: 'Sex' } },
          y: {
            title: { display: true, text: 'Number of Participants' },
            beginAtZero: true, // Ensure y-axis starts at zero
            suggestedMax: Math.max(...data) * 1.1 // Add 10% padding above the max value
          }
        }
      }
    });
  }

  // Function to create a bar chart for the number of participants by Country
  function createCountryBarChart(filteredPatients) {
    const countryCounts = filteredPatients.reduce((acc, patient) => {
      const country = patient['Country'] || 'Unknown';
      acc[country] = (acc[country] || 0) + 1;
      return acc;
    }, {});

    const labels = Object.keys(countryCounts);
    const data = Object.values(countryCounts);

    if (countryBarChart) {
      countryBarChart.destroy();
    }

    const ctx = document.getElementById('countryBarChart').getContext('2d');
    countryBarChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Number of Participants by Country',
          data: data,
          backgroundColor: '#3498DB',
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'Number of Participants by Country'
          }
        },
        scales: {
          x: { title: { display: true, text: 'Country' } },
          y: { title: { display: true, text: 'Number of Participants' } }
        }
      }
    });
  }

  // Function to calculate and display the distribution of Primary Causes
  function updatePrimaryCauseTable(filteredPatients) {
    const causeCounts = filteredPatients.reduce((acc, patient) => {
      const cause = patient['Primary Cause'] || 'Unknown';
      acc[cause] = (acc[cause] || 0) + 1;
      return acc;
    }, {});

    const total = filteredPatients.length;
    const causePercentages = Object.entries(causeCounts).map(([cause, count]) => ({
      cause,
      percentage: ((count / total) * 100).toFixed(1)
    }));

    // Sort from biggest to smallest
    causePercentages.sort((a, b) => b.percentage - a.percentage);

    const primaryCauseTableBody = document.querySelector('#primaryCauseTable tbody');
    primaryCauseTableBody.innerHTML = causePercentages.map(item => {
      const color = getColorForPercentage(item.percentage);
      return `
        <tr>
          <td style="text-align: center;">${item.cause}</td>
          <td style="background-color: ${color}; text-align: center;">${item.percentage}%</td>
        </tr>
      `;
    }).join('');
  }

  // Color coding function for percentages
  function getColorForPercentage(value) {
    const percentage = parseFloat(value);
    const ratioPercent = Math.min(percentage / 100, 1);

    const red = 255;
    const green = Math.floor(255 * (1 - ratioPercent));

    return `rgb(${red}, ${green}, 0)`;
  }

  // Function to calculate odds ratio between each variable and the outcome "Secondary Hypertension"
  function calculateOddsRatio(filteredPatients) {
    // Function to calculate odds ratio
    function computeOddsRatio(a, b, c, d) {
      if (b === 0 || c === 0) return 'N/A';
      return (a / b) / (c / d);
    }

    // Calculate odds ratio for each variable
    const oddsRatios = variablesList.map(variable => {
      let a = 0, b = 0, c = 0, d = 0;

      filteredPatients.forEach(patient => {
        const outcome = getValue(patient, 'Secondary Hypertension');
        const exposure = getValue(patient, variable);

        if (exposure && outcome) a++;
        else if (exposure && !outcome) b++;
        else if (!exposure && outcome) c++;
        else d++;
      });

      const oddsRatio = computeOddsRatio(a, b, c, d);
      return { name: variable, value: isFinite(oddsRatio) ? oddsRatio.toFixed(1) : 'N/A' };
    });

    // Sort the odds ratios by value in descending order and filter out "N/A"
    const validOddsRatios = oddsRatios
      .filter(or => or.value !== 'N/A')
      .sort((a, b) => parseFloat(b.value) - parseFloat(a.value));

    const oddsRatioTableBody = document.querySelector('#oddsRatioTable tbody');
    oddsRatioTableBody.innerHTML = validOddsRatios.map(or => {
      const color = getColorForOddsRatio(or.value);
      return `
        <tr>
          <td style="text-align: center;">${or.name}</td>
          <td style="background-color: ${color}; text-align: center;">${or.value}</td>
        </tr>
      `;
    }).join('');
  }

  // Color coding function for odds ratios
  function getColorForOddsRatio(value) {
    if (value === 'N/A') return '#ffffff'; // No color for N/A values
    const ratio = parseFloat(value);
    const minRatio = 1;
    const maxRatio = 6;

    const ratioPercent = Math.min((ratio - minRatio) / (maxRatio - minRatio), 1);

    const red = 255;
    const green = Math.floor(255 * (1 - ratioPercent));

    return `rgb(${red}, ${green}, 0)`;
  }

  function updateResults() {
    const countryFilter = document.getElementById('countryFilter').value;
    const primaryCauseFilter = document.getElementById('primaryCauseFilter').value;
    const binaryFilters = {};

    variablesList.forEach(variable => {
      const value = document.querySelector(`select[name="${variable}"]`).value;
      binaryFilters[variable] = value;
    });

    // Filter patient data based on dropdowns and binary filters
    const filteredPatients = patientData.filter(patient => {
      const countryMatch = (countryFilter === 'All' || patient['Country'] === countryFilter);
      const causeMatch = (primaryCauseFilter === 'All' || patient['Primary Cause'] === primaryCauseFilter);

      const binaryMatch = Object.entries(binaryFilters).every(([key, value]) => {
        const patientValue = getValue(patient, key);
        if (value === 'All') return true;  // No filtering
        if (value === '1') return patientValue === 1;
        if (value === '0') return patientValue === 0;
        return false;  // Default return false for safety
      });

      return countryMatch && causeMatch && binaryMatch;
    });

    // Update participant count and create charts
    updateParticipantCount(filteredPatients);
    createAgeHistogram(filteredPatients);
    createMaleBarChart(filteredPatients);
    createCountryBarChart(filteredPatients);
    updatePrimaryCauseTable(filteredPatients);
    calculateOddsRatio(filteredPatients);

    // Calculate percentage of Secondary Hypertension cases
    const secondaryCount = filteredPatients.filter(p => getValue(p, 'Secondary Hypertension') === 1).length;
    const percentage = filteredPatients.length ? (secondaryCount / filteredPatients.length) * 100 : 0;
    document.getElementById('secondaryHypertensionPercentage').textContent = `${percentage.toFixed(1)}%`;

    // Sort and display the filtered data
    filteredPatients.sort((a, b) => getValue(b, 'Secondary Hypertension') - getValue(a, 'Secondary Hypertension'));
    const patientTableBody = document.querySelector('#patientTable tbody');
    patientTableBody.innerHTML = filteredPatients.map(patient => {
      const rowClass = getValue(patient, 'Secondary Hypertension') === 1 ? 'secondary-hypertension' : 'primary-hypertension';
      const rowCells = ['Age', 'Country', 'Primary Cause', 'Male', ...variablesList.slice(1)].map(key => `<td>${patient[key] || ''}</td>`).join('');
      return `<tr class="${rowClass}">${rowCells}</tr>`;
    }).join('');
  }
</script>

</body>
